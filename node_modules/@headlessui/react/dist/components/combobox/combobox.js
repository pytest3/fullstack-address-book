import{useVirtualizer as Ae}from"@tanstack/react-virtual";import w,{createContext as le,createRef as Se,Fragment as fe,useCallback as Ee,useContext as ie,useEffect as Pe,useMemo as U,useReducer as Ie,useRef as M,useState as Ve}from"react";import{useComputed as ue}from'../../hooks/use-computed.js';import{useControllable as _e}from'../../hooks/use-controllable.js';import{useDisposables as pe}from'../../hooks/use-disposables.js';import{useEvent as x}from'../../hooks/use-event.js';import{useId as Z}from'../../hooks/use-id.js';import{useIsoMorphicEffect as H}from'../../hooks/use-iso-morphic-effect.js';import{useLatestValue as Fe}from'../../hooks/use-latest-value.js';import{useOutsideClick as Le}from'../../hooks/use-outside-click.js';import{useOwnerDocument as De}from'../../hooks/use-owner.js';import{useResolveButtonType as Me}from'../../hooks/use-resolve-button-type.js';import{useSyncRefs as ee}from'../../hooks/use-sync-refs.js';import{useTrackedPointer as he}from'../../hooks/use-tracked-pointer.js';import{useTreeWalker as Be}from'../../hooks/use-tree-walker.js';import{useWatch as me}from'../../hooks/use-watch.js';import{Features as ke,Hidden as we}from'../../internal/hidden.js';import{OpenClosedProvider as Ue,State as re,useOpenClosed as He}from'../../internal/open-closed.js';import{history as Te}from'../../utils/active-element-history.js';import{isDisabledReactIssue7711 as Ne}from'../../utils/bugs.js';import{calculateActiveIndex as xe,Focus as A}from'../../utils/calculate-active-index.js';import{disposables as ge}from'../../utils/disposables.js';import{sortByDomNode as Ge}from'../../utils/focus-management.js';import{objectToFormEntries as Xe}from'../../utils/form.js';import{match as $}from'../../utils/match.js';import{isMobile as je}from'../../utils/platform.js';import{compact as Je,Features as ve,forwardRefWithAs as q,render as z}from'../../utils/render.js';import{Keys as L}from'../keyboard.js';var Ke=(o=>(o[o.Open=0]="Open",o[o.Closed=1]="Closed",o))(Ke||{}),We=(o=>(o[o.Single=0]="Single",o[o.Multi=1]="Multi",o))(We||{}),$e=(r=>(r[r.Pointer=0]="Pointer",r[r.Focus=1]="Focus",r[r.Other=2]="Other",r))($e||{}),qe=(e=>(e[e.OpenCombobox=0]="OpenCombobox",e[e.CloseCombobox=1]="CloseCombobox",e[e.GoToOption=2]="GoToOption",e[e.RegisterOption=3]="RegisterOption",e[e.UnregisterOption=4]="UnregisterOption",e[e.RegisterLabel=5]="RegisterLabel",e[e.SetActivationTrigger=6]="SetActivationTrigger",e[e.UpdateVirtualOptions=7]="UpdateVirtualOptions",e))(qe||{});function se(t,n=o=>o){let o=t.activeOptionIndex!==null?t.options[t.activeOptionIndex]:null,r=n(t.options.slice()),l=r.length>0&&r[0].dataRef.current.order!==null?r.sort((p,T)=>p.dataRef.current.order-T.dataRef.current.order):Ge(r,p=>p.dataRef.current.domRef.current),i=o?l.indexOf(o):null;return i===-1&&(i=null),{options:l,activeOptionIndex:i}}let ze={[1](t){var n;return(n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===1?t:{...t,activeOptionIndex:null,comboboxState:1}},[0](t){var n,o;if((n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===0)return t;if((o=t.dataRef.current)!=null&&o.value){let r=t.dataRef.current.calculateIndex(t.dataRef.current.value);if(r!==-1)return{...t,activeOptionIndex:r,comboboxState:0}}return{...t,comboboxState:0}},[2](t,n){var i,p,T,e,a;if((i=t.dataRef.current)!=null&&i.disabled||(p=t.dataRef.current)!=null&&p.optionsRef.current&&!((T=t.dataRef.current)!=null&&T.optionsPropsRef.current.static)&&t.comboboxState===1)return t;if(t.virtual){let g=n.focus===A.Specific?n.idx:xe(n,{resolveItems:()=>t.virtual.options,resolveActiveIndex:()=>{var f,u;return(u=(f=t.activeOptionIndex)!=null?f:t.virtual.options.findIndex(E=>!t.virtual.disabled(E)))!=null?u:null},resolveDisabled:t.virtual.disabled,resolveId(){throw new Error("Function not implemented.")}}),O=(e=n.trigger)!=null?e:2;return t.activeOptionIndex===g&&t.activationTrigger===O?t:{...t,activeOptionIndex:g,activationTrigger:O}}let o=se(t);if(o.activeOptionIndex===null){let g=o.options.findIndex(O=>!O.dataRef.current.disabled);g!==-1&&(o.activeOptionIndex=g)}let r=n.focus===A.Specific?n.idx:xe(n,{resolveItems:()=>o.options,resolveActiveIndex:()=>o.activeOptionIndex,resolveId:g=>g.id,resolveDisabled:g=>g.dataRef.current.disabled}),l=(a=n.trigger)!=null?a:2;return t.activeOptionIndex===r&&t.activationTrigger===l?t:{...t,...o,activeOptionIndex:r,activationTrigger:l}},[3]:(t,n)=>{var i,p,T;if((i=t.dataRef.current)!=null&&i.virtual)return{...t,options:[...t.options,n.payload]};let o=n.payload,r=se(t,e=>(e.push(o),e));t.activeOptionIndex===null&&(p=t.dataRef.current)!=null&&p.isSelected(n.payload.dataRef.current.value)&&(r.activeOptionIndex=r.options.indexOf(o));let l={...t,...r,activationTrigger:2};return(T=t.dataRef.current)!=null&&T.__demoMode&&t.dataRef.current.value===void 0&&(l.activeOptionIndex=0),l},[4]:(t,n)=>{var r;if((r=t.dataRef.current)!=null&&r.virtual)return{...t,options:t.options.filter(l=>l.id!==n.id)};let o=se(t,l=>{let i=l.findIndex(p=>p.id===n.id);return i!==-1&&l.splice(i,1),l});return{...t,...o,activationTrigger:2}},[5]:(t,n)=>t.labelId===n.id?t:{...t,labelId:n.id},[6]:(t,n)=>t.activationTrigger===n.trigger?t:{...t,activationTrigger:n.trigger},[7]:(t,n)=>{var r;if(((r=t.virtual)==null?void 0:r.options)===n.options)return t;let o=t.activeOptionIndex;if(t.activeOptionIndex!==null){let l=n.options.indexOf(t.virtual.options[t.activeOptionIndex]);l!==-1?o=l:o=null}return{...t,activeOptionIndex:o,virtual:Object.assign({},t.virtual,{options:n.options})}}},de=le(null);de.displayName="ComboboxActionsContext";function te(t){let n=ie(de);if(n===null){let o=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,te),o}return n}let Oe=le(null);function Ye(t){var T;let n=j("VirtualProvider"),[o,r]=U(()=>{let e=n.optionsRef.current;if(!e)return[0,0];let a=window.getComputedStyle(e);return[parseFloat(a.paddingBlockStart||a.paddingTop),parseFloat(a.paddingBlockEnd||a.paddingBottom)]},[n.optionsRef.current]),l=Ae({scrollPaddingStart:o,scrollPaddingEnd:r,count:n.virtual.options.length,estimateSize(){return 40},getScrollElement(){var e;return(e=n.optionsRef.current)!=null?e:null},overscan:12}),[i,p]=Ve(0);return H(()=>{p(e=>e+1)},[(T=n.virtual)==null?void 0:T.options]),w.createElement(Oe.Provider,{value:l},w.createElement("div",{style:{position:"relative",width:"100%",height:`${l.getTotalSize()}px`},ref:e=>{if(e){if(typeof process!="undefined"&&process.env.JEST_WORKER_ID!==void 0||n.activationTrigger===0)return;n.activeOptionIndex!==null&&n.virtual.options.length>n.activeOptionIndex&&l.scrollToIndex(n.activeOptionIndex)}}},l.getVirtualItems().map(e=>{var a;return w.createElement(fe,{key:e.key},w.cloneElement((a=t.children)==null?void 0:a.call(t,{option:n.virtual.options[e.index],open:n.comboboxState===0}),{key:`${i}-${e.key}`,"data-index":e.index,"aria-setsize":n.virtual.options.length,"aria-posinset":e.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${e.start}px)`,overflowAnchor:"none"}}))})))}let be=le(null);be.displayName="ComboboxDataContext";function j(t){let n=ie(be);if(n===null){let o=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,j),o}return n}function Qe(t,n){return $(n.type,ze,t,n)}let Ze=fe;function et(t,n){var ce;let{value:o,defaultValue:r,onChange:l,form:i,name:p,by:T=null,disabled:e=!1,__demoMode:a=!1,nullable:g=!1,multiple:O=!1,immediate:f=!1,virtual:u=null,...E}=t,[v=O?[]:void 0,m]=_e(o,l,r),[P,V]=Ie(Qe,{dataRef:Se(),comboboxState:a?0:1,options:[],virtual:u?{options:u.options,disabled:(ce=u.disabled)!=null?ce:()=>!1}:null,activeOptionIndex:null,activationTrigger:2,labelId:null}),B=M(!1),X=M({static:!1,hold:!1}),J=M(null),K=M(null),W=M(null),Y=M(null),k=x(typeof T=="string"?(b,c)=>{let I=T;return(b==null?void 0:b[I])===(c==null?void 0:c[I])}:T!=null?T:(b,c)=>b===c),N=x(b=>u?T===null?u.options.indexOf(b):u.options.findIndex(c=>k(c,b)):P.options.findIndex(c=>k(c.dataRef.current.value,b))),C=Ee(b=>$(d.mode,{[1]:()=>v.some(c=>k(c,b)),[0]:()=>k(v,b)}),[v]),y=x(b=>P.activeOptionIndex===N(b)),d=U(()=>({...P,immediate:f,optionsPropsRef:X,labelRef:J,inputRef:K,buttonRef:W,optionsRef:Y,value:v,defaultValue:r,disabled:e,mode:O?1:0,virtual:P.virtual,get activeOptionIndex(){if(B.current&&P.activeOptionIndex===null&&(u?u.options.length>0:P.options.length>0)){if(u){let c=u.options.findIndex(I=>{var G,Q;return!((Q=(G=u==null?void 0:u.disabled)==null?void 0:G.call(u,I))!=null&&Q)});if(c!==-1)return c}let b=P.options.findIndex(c=>!c.dataRef.current.disabled);if(b!==-1)return b}return P.activeOptionIndex},calculateIndex:N,compare:k,isSelected:C,isActive:y,nullable:g,__demoMode:a}),[v,r,e,O,g,a,P,u]);H(()=>{u&&V({type:7,options:u.options})},[u,u==null?void 0:u.options]),H(()=>{P.dataRef.current=d},[d]),Le([d.buttonRef,d.inputRef,d.optionsRef],()=>ae.closeCombobox(),d.comboboxState===0);let oe=U(()=>{var b,c,I;return{open:d.comboboxState===0,disabled:e,activeIndex:d.activeOptionIndex,activeOption:d.activeOptionIndex===null?null:d.virtual?d.virtual.options[(b=d.activeOptionIndex)!=null?b:0]:(I=(c=d.options[d.activeOptionIndex])==null?void 0:c.dataRef.current.value)!=null?I:null,value:v}},[d,e,v]),s=x(()=>{if(d.activeOptionIndex!==null){if(d.virtual)h(d.virtual.options[d.activeOptionIndex]);else{let{dataRef:b}=d.options[d.activeOptionIndex];h(b.current.value)}ae.goToOption(A.Specific,d.activeOptionIndex)}}),_=x(()=>{V({type:0}),B.current=!0}),S=x(()=>{V({type:1}),B.current=!1}),D=x((b,c,I)=>(B.current=!1,b===A.Specific?V({type:2,focus:A.Specific,idx:c,trigger:I}):V({type:2,focus:b,trigger:I}))),R=x((b,c)=>(V({type:3,payload:{id:b,dataRef:c}}),()=>{d.isActive(c.current.value)&&(B.current=!0),V({type:4,id:b})})),F=x(b=>(V({type:5,id:b}),()=>V({type:5,id:null}))),h=x(b=>$(d.mode,{[0](){return m==null?void 0:m(b)},[1](){let c=d.value.slice(),I=c.findIndex(G=>k(G,b));return I===-1?c.push(b):c.splice(I,1),m==null?void 0:m(c)}})),Ce=x(b=>{V({type:6,trigger:b})}),ae=U(()=>({onChange:h,registerOption:R,registerLabel:F,goToOption:D,closeCombobox:S,openCombobox:_,setActivationTrigger:Ce,selectActiveOption:s}),[]),ye=n===null?{}:{ref:n},ne=M(null),Re=pe();return Pe(()=>{ne.current&&r!==void 0&&Re.addEventListener(ne.current,"reset",()=>{m==null||m(r)})},[ne,m]),w.createElement(de.Provider,{value:ae},w.createElement(be.Provider,{value:d},w.createElement(Ue,{value:$(d.comboboxState,{[0]:re.Open,[1]:re.Closed})},p!=null&&v!=null&&Xe({[p]:v}).map(([b,c],I)=>w.createElement(we,{features:ke.Hidden,ref:I===0?G=>{var Q;ne.current=(Q=G==null?void 0:G.closest("form"))!=null?Q:null}:void 0,...Je({key:b,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:i,name:b,value:c})})),z({ourProps:ye,theirProps:E,slot:oe,defaultTag:Ze,name:"Combobox"}))))}let tt="input";function ot(t,n){var N,C,y,d,oe;let o=Z(),{id:r=`headlessui-combobox-input-${o}`,onChange:l,displayValue:i,type:p="text",...T}=t,e=j("Combobox.Input"),a=te("Combobox.Input"),g=ee(e.inputRef,n),O=De(e.inputRef),f=M(!1),u=pe(),E=x(()=>{a.onChange(null),e.optionsRef.current&&(e.optionsRef.current.scrollTop=0),a.goToOption(A.Nothing)}),v=function(){var s;return typeof i=="function"&&e.value!==void 0?(s=i(e.value))!=null?s:"":typeof e.value=="string"?e.value:""}();me(([s,_],[S,D])=>{if(f.current)return;let R=e.inputRef.current;R&&((D===0&&_===1||s!==S)&&(R.value=s),requestAnimationFrame(()=>{if(f.current||!R||(O==null?void 0:O.activeElement)!==R)return;let{selectionStart:F,selectionEnd:h}=R;Math.abs((h!=null?h:0)-(F!=null?F:0))===0&&F===0&&R.setSelectionRange(R.value.length,R.value.length)}))},[v,e.comboboxState,O]),me(([s],[_])=>{if(s===0&&_===1){if(f.current)return;let S=e.inputRef.current;if(!S)return;let D=S.value,{selectionStart:R,selectionEnd:F,selectionDirection:h}=S;S.value="",S.value=D,h!==null?S.setSelectionRange(R,F,h):S.setSelectionRange(R,F)}},[e.comboboxState]);let m=M(!1),P=x(()=>{m.current=!0}),V=x(()=>{u.nextFrame(()=>{m.current=!1})}),B=x(s=>{switch(f.current=!0,s.key){case L.Enter:if(f.current=!1,e.comboboxState!==0||m.current)return;if(s.preventDefault(),s.stopPropagation(),e.activeOptionIndex===null){a.closeCombobox();return}a.selectActiveOption(),e.mode===0&&a.closeCombobox();break;case L.ArrowDown:return f.current=!1,s.preventDefault(),s.stopPropagation(),$(e.comboboxState,{[0]:()=>a.goToOption(A.Next),[1]:()=>a.openCombobox()});case L.ArrowUp:return f.current=!1,s.preventDefault(),s.stopPropagation(),$(e.comboboxState,{[0]:()=>a.goToOption(A.Previous),[1]:()=>{a.openCombobox(),u.nextFrame(()=>{e.value||a.goToOption(A.Last)})}});case L.Home:if(s.shiftKey)break;return f.current=!1,s.preventDefault(),s.stopPropagation(),a.goToOption(A.First);case L.PageUp:return f.current=!1,s.preventDefault(),s.stopPropagation(),a.goToOption(A.First);case L.End:if(s.shiftKey)break;return f.current=!1,s.preventDefault(),s.stopPropagation(),a.goToOption(A.Last);case L.PageDown:return f.current=!1,s.preventDefault(),s.stopPropagation(),a.goToOption(A.Last);case L.Escape:return f.current=!1,e.comboboxState!==0?void 0:(s.preventDefault(),e.optionsRef.current&&!e.optionsPropsRef.current.static&&s.stopPropagation(),e.nullable&&e.mode===0&&e.value===null&&E(),a.closeCombobox());case L.Tab:if(f.current=!1,e.comboboxState!==0)return;e.mode===0&&e.activationTrigger!==1&&a.selectActiveOption(),a.closeCombobox();break}}),X=x(s=>{l==null||l(s),e.nullable&&e.mode===0&&s.target.value===""&&E(),a.openCombobox()}),J=x(s=>{var S,D,R;let _=(S=s.relatedTarget)!=null?S:Te.find(F=>F!==s.currentTarget);if(f.current=!1,!((D=e.optionsRef.current)!=null&&D.contains(_))&&!((R=e.buttonRef.current)!=null&&R.contains(_))&&e.comboboxState===0)return s.preventDefault(),e.mode===0&&(e.nullable&&e.value===null?E():e.activationTrigger!==1&&a.selectActiveOption()),a.closeCombobox()}),K=x(s=>{var S,D,R;let _=(S=s.relatedTarget)!=null?S:Te.find(F=>F!==s.currentTarget);(D=e.buttonRef.current)!=null&&D.contains(_)||(R=e.optionsRef.current)!=null&&R.contains(_)||e.disabled||e.immediate&&e.comboboxState!==0&&(a.openCombobox(),u.nextFrame(()=>{a.setActivationTrigger(1)}))}),W=ue(()=>{if(e.labelId)return[e.labelId].join(" ")},[e.labelId]),Y=U(()=>({open:e.comboboxState===0,disabled:e.disabled}),[e]),k={ref:g,id:r,role:"combobox",type:p,"aria-controls":(N=e.optionsRef.current)==null?void 0:N.id,"aria-expanded":e.comboboxState===0,"aria-activedescendant":e.activeOptionIndex===null?void 0:e.virtual?(C=e.options.find(s=>{var _;return!((_=e.virtual)!=null&&_.disabled(s.dataRef.current.value))&&e.compare(s.dataRef.current.value,e.virtual.options[e.activeOptionIndex])}))==null?void 0:C.id:(y=e.options[e.activeOptionIndex])==null?void 0:y.id,"aria-labelledby":W,"aria-autocomplete":"list",defaultValue:(oe=(d=t.defaultValue)!=null?d:e.defaultValue!==void 0?i==null?void 0:i(e.defaultValue):null)!=null?oe:e.defaultValue,disabled:e.disabled,onCompositionStart:P,onCompositionEnd:V,onKeyDown:B,onChange:X,onFocus:K,onBlur:J};return z({ourProps:k,theirProps:T,slot:Y,defaultTag:tt,name:"Combobox.Input"})}let nt="button";function rt(t,n){var E;let o=j("Combobox.Button"),r=te("Combobox.Button"),l=ee(o.buttonRef,n),i=Z(),{id:p=`headlessui-combobox-button-${i}`,...T}=t,e=pe(),a=x(v=>{switch(v.key){case L.ArrowDown:return v.preventDefault(),v.stopPropagation(),o.comboboxState===1&&r.openCombobox(),e.nextFrame(()=>{var m;return(m=o.inputRef.current)==null?void 0:m.focus({preventScroll:!0})});case L.ArrowUp:return v.preventDefault(),v.stopPropagation(),o.comboboxState===1&&(r.openCombobox(),e.nextFrame(()=>{o.value||r.goToOption(A.Last)})),e.nextFrame(()=>{var m;return(m=o.inputRef.current)==null?void 0:m.focus({preventScroll:!0})});case L.Escape:return o.comboboxState!==0?void 0:(v.preventDefault(),o.optionsRef.current&&!o.optionsPropsRef.current.static&&v.stopPropagation(),r.closeCombobox(),e.nextFrame(()=>{var m;return(m=o.inputRef.current)==null?void 0:m.focus({preventScroll:!0})}));default:return}}),g=x(v=>{if(Ne(v.currentTarget))return v.preventDefault();o.comboboxState===0?r.closeCombobox():(v.preventDefault(),r.openCombobox()),e.nextFrame(()=>{var m;return(m=o.inputRef.current)==null?void 0:m.focus({preventScroll:!0})})}),O=ue(()=>{if(o.labelId)return[o.labelId,p].join(" ")},[o.labelId,p]),f=U(()=>({open:o.comboboxState===0,disabled:o.disabled,value:o.value}),[o]),u={ref:l,id:p,type:Me(t,o.buttonRef),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(E=o.optionsRef.current)==null?void 0:E.id,"aria-expanded":o.comboboxState===0,"aria-labelledby":O,disabled:o.disabled,onClick:g,onKeyDown:a};return z({ourProps:u,theirProps:T,slot:f,defaultTag:nt,name:"Combobox.Button"})}let at="label";function lt(t,n){let o=Z(),{id:r=`headlessui-combobox-label-${o}`,...l}=t,i=j("Combobox.Label"),p=te("Combobox.Label"),T=ee(i.labelRef,n);H(()=>p.registerLabel(r),[r]);let e=x(()=>{var O;return(O=i.inputRef.current)==null?void 0:O.focus({preventScroll:!0})}),a=U(()=>({open:i.comboboxState===0,disabled:i.disabled}),[i]);return z({ourProps:{ref:T,id:r,onClick:e},theirProps:l,slot:a,defaultTag:at,name:"Combobox.Label"})}let it="ul",ut=ve.RenderStrategy|ve.Static;function pt(t,n){let o=Z(),{id:r=`headlessui-combobox-options-${o}`,hold:l=!1,...i}=t,p=j("Combobox.Options"),T=ee(p.optionsRef,n),e=He(),a=(()=>e!==null?(e&re.Open)===re.Open:p.comboboxState===0)();H(()=>{var u;p.optionsPropsRef.current.static=(u=t.static)!=null?u:!1},[p.optionsPropsRef,t.static]),H(()=>{p.optionsPropsRef.current.hold=l},[p.optionsPropsRef,l]),Be({container:p.optionsRef.current,enabled:p.comboboxState===0,accept(u){return u.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:u.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(u){u.setAttribute("role","none")}});let g=ue(()=>{var u,E;return(E=p.labelId)!=null?E:(u=p.buttonRef.current)==null?void 0:u.id},[p.labelId,p.buttonRef.current]),O=U(()=>({open:p.comboboxState===0,option:void 0}),[p]),f={"aria-labelledby":g,role:"listbox","aria-multiselectable":p.mode===1?!0:void 0,id:r,ref:T};return p.virtual&&p.comboboxState===0&&Object.assign(i,{children:w.createElement(Ye,null,i.children)}),z({ourProps:f,theirProps:i,slot:O,defaultTag:it,features:ut,visible:a,name:"Combobox.Options"})}let st="li";function dt(t,n){var N;let o=Z(),{id:r=`headlessui-combobox-option-${o}`,disabled:l=!1,value:i,order:p=null,...T}=t,e=j("Combobox.Option"),a=te("Combobox.Option"),g=e.virtual?e.activeOptionIndex===e.calculateIndex(i):e.activeOptionIndex===null?!1:((N=e.options[e.activeOptionIndex])==null?void 0:N.id)===r,O=e.isSelected(i),f=M(null),u=Fe({disabled:l,value:i,domRef:f,order:p}),E=ie(Oe),v=ee(n,f,E?E.measureElement:null),m=x(()=>a.onChange(i));H(()=>a.registerOption(r,u),[u,r]);let P=M(!(e.virtual||e.__demoMode));H(()=>{if(!e.virtual||!e.__demoMode)return;let C=ge();return C.requestAnimationFrame(()=>{P.current=!0}),C.dispose},[e.virtual,e.__demoMode]),H(()=>{if(!P.current||e.comboboxState!==0||!g||e.activationTrigger===0)return;let C=ge();return C.requestAnimationFrame(()=>{var y,d;(d=(y=f.current)==null?void 0:y.scrollIntoView)==null||d.call(y,{block:"nearest"})}),C.dispose},[f,g,e.comboboxState,e.activationTrigger,e.activeOptionIndex]);let V=x(C=>{var y;if(l||(y=e.virtual)!=null&&y.disabled(i))return C.preventDefault();m(),je()||requestAnimationFrame(()=>{var d;return(d=e.inputRef.current)==null?void 0:d.focus({preventScroll:!0})}),e.mode===0&&requestAnimationFrame(()=>a.closeCombobox())}),B=x(()=>{var y;if(l||(y=e.virtual)!=null&&y.disabled(i))return a.goToOption(A.Nothing);let C=e.calculateIndex(i);a.goToOption(A.Specific,C)}),X=he(),J=x(C=>X.update(C)),K=x(C=>{var d;if(!X.wasMoved(C)||l||(d=e.virtual)!=null&&d.disabled(i)||g)return;let y=e.calculateIndex(i);a.goToOption(A.Specific,y,0)}),W=x(C=>{var y;X.wasMoved(C)&&(l||(y=e.virtual)!=null&&y.disabled(i)||g&&(e.optionsPropsRef.current.hold||a.goToOption(A.Nothing)))}),Y=U(()=>({active:g,selected:O,disabled:l}),[g,O,l]);return z({ourProps:{id:r,ref:v,role:"option",tabIndex:l===!0?void 0:-1,"aria-disabled":l===!0?!0:void 0,"aria-selected":O,disabled:void 0,onClick:V,onFocus:B,onPointerEnter:J,onMouseEnter:J,onPointerMove:K,onMouseMove:K,onPointerLeave:W,onMouseLeave:W},theirProps:T,slot:Y,defaultTag:st,name:"Combobox.Option"})}let bt=q(et),ct=q(rt),ft=q(ot),mt=q(lt),Tt=q(pt),xt=q(dt),Wt=Object.assign(bt,{Input:ft,Button:ct,Label:mt,Options:Tt,Option:xt});export{Wt as Combobox};
